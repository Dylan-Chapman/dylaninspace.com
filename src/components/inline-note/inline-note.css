@tailwind base;
@tailwind components;

@layer base {
  :root {
    --inline-note-surface: theme("colors.cosmos-dark.900 / 0.78");
    --inline-note-border: theme("colors.cosmos-secondary.400 / 0.32");
    --inline-note-border-strong: theme("colors.cosmos-secondary.500 / 0.48");
    --inline-note-foreground: theme("colors.cosmos-white / 0.94");
    --inline-note-foreground-muted: theme("colors.cosmos-secondary.100 / 0.78");
    --inline-note-divider: theme("colors.cosmos-secondary.400 / 0.22");
    --inline-note-card-border-width: 1px;
    --inline-note-card-radius: 0.375rem;
    --inline-note-marker-dimension: 2.4rem;
  }
}

@layer components {
  .inline-note {
    --inline-note-open-color: theme("colors.cosmos-accent.400");
    @apply relative inline-block;
  }

  .inline-note__trigger {
    vertical-align: super;
    @apply inline-flex items-center gap-1 text-[0.85rem] font-semibold tracking-[0.16em] text-cosmos-accent transition-colors duration-150 appearance-none p-0 leading-none;
  }

  .inline-note__trigger:hover {
    @apply text-cosmos-accent/70;
  }

  .inline-note__trigger:focus-visible {
    @apply outline outline-2 outline-offset-2 outline-cosmos-accent;
  }

  .inline-note-card {
    background-color: var(--inline-note-surface);
    border-width: var(--inline-note-card-border-width);
    border-color: var(--inline-note-border-strong);
    border-radius: var(--inline-note-card-radius);
    color: var(--inline-note-foreground);
    @apply border-solid whitespace-normal backdrop-blur-sm text-[0.82rem];
  }

  .inline-note-card--popover,
  .inline-note-card--rollup {
    @apply px-6 py-4;
  }

  .inline-note-card > p {
    @apply mt-0 mb-3;
  }

  .inline-note-card > p:last-child {
    @apply mb-0;
  }

  .inline-note-card a {
    @apply text-cosmos-secondary underline underline-offset-2 transition-colors duration-150;
  }

  .inline-note-card a:hover {
    @apply text-cosmos-accent;
  }

  .inline-note-group {
    @apply whitespace-nowrap;
  }

  .inline-note__card {
    position: absolute;
    z-index: 50;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    display: none;
    min-width: clamp(18rem, 33vw, 28rem);
    max-width: clamp(24rem, 48vw, 36rem);
  }

  [data-inline-note-open="true"] > [data-inline-note-trigger] {
    color: var(--inline-note-open-color);
    transform: translateY(-0.06em);
  }

  .inline-note__card::before {
    content: "";
    position: absolute;
    left: 50%;
    top: -0.48rem;
    width: 0.92rem;
    height: 0.92rem;
    background-color: var(--inline-note-surface);
    border-left: var(--inline-note-card-border-width) solid
      var(--inline-note-border-strong);
    border-top: var(--inline-note-card-border-width) solid
      var(--inline-note-border-strong);
    transform: translate(-50%, 0) rotate(45deg);
    pointer-events: none;
  }

  [data-inline-note-open="true"] .inline-note__card {
    display: block;
  }

  [data-inline-note-open="false"] .inline-note__card {
    display: none;
  }

  .inline-note--align-end .inline-note__card {
    left: auto;
    right: 0;
    transform: none;
  }

  .inline-note--align-end .inline-note__card::before {
    left: auto;
    right: 1.75rem;
    transform: rotate(45deg);
  }

  .inline-note--align-start .inline-note__card {
    left: 0;
    right: auto;
    transform: none;
  }

  .inline-note--align-start .inline-note__card::before {
    left: 1.75rem;
    right: auto;
    transform: rotate(45deg);
  }

  @media (max-width: 640px) {
    .inline-note__card {
      left: 50%;
      right: auto;
      transform: translateX(-50%);
      min-width: min(18.5rem, calc(100vw - 2rem));
      max-width: min(24rem, calc(100vw - 2rem));
    }

    .inline-note__card::before {
      left: 50%;
      right: auto;
      transform: translate(-50%, 0) rotate(45deg);
    }

    .inline-note--align-start .inline-note__card,
    .inline-note--align-end .inline-note__card {
      left: 50%;
      right: auto;
      transform: translateX(-50%);
    }

    .inline-note--align-start .inline-note__card::before,
    .inline-note--align-end .inline-note__card::before {
      left: 50%;
      right: auto;
      transform: translate(-50%, 0) rotate(45deg);
    }
  }

  .inline-note-rollup {
    margin-top: clamp(3rem, 8vw, 4.75rem);
    padding-top: clamp(2rem, 6vw, 3.5rem);
    border-top: 1px solid var(--inline-note-divider);
    @apply flex flex-col;
    gap: clamp(1.75rem, 4vw, 2.5rem);
  }

  .inline-note-rollup__title {
    font-size: clamp(1.05rem, 2vw, 1.35rem);
    color: var(--inline-note-foreground-muted);
    @apply font-cosmos-space uppercase tracking-[0.2em];
  }

  .inline-note-rollup__items {
    @apply grid;
    gap: clamp(1.25rem, 3vw, 2rem);
  }

  .inline-note-rollup__item {
    @apply flex items-start;
    gap: 1rem;
  }

  .inline-note-rollup__marker {
    flex: 0 0 var(--inline-note-marker-dimension);
    height: var(--inline-note-marker-dimension);
    @apply flex items-center justify-center rounded-full text-sm font-semibold;
    border: 1px solid var(--inline-note-border);
    background: var(--inline-note-surface);
    color: var(--inline-note-foreground-muted);
  }

  .inline-note-rollup__card {
    position: relative;
    width: min(48ch, 100%);
  }

  @media (min-width: 768px) {
    .inline-note-rollup__items {
      grid-template-columns: repeat(auto-fit, minmax(22rem, 1fr));
    }

    .inline-note-rollup__item {
      @apply items-stretch;
    }

    .inline-note-rollup__card {
      height: 100%;
    }
  }
}
